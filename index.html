<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Встретимся в бане спарком</title>
    <meta name="description" content="Портал про баню">
    <meta name="author" content="poehali.dev"/>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <meta property="og:title" content="Встретимся в бане спарком">
    <meta property="og:description" content="Портал про баню">
    <meta property="og:image:width" content="4800">
    <meta property="og:image:height" content="2520">
    <meta property="og:image:alt" content="Поехали! — сервис разработки сайтов с помощью ИИ">
    <meta property="og:image" content="https://cdn.poehali.dev/intertnal/img/og.png">
    <meta name="twitter:image" content="https://cdn.poehali.dev/intertnal/img/og.png">

    <!-- IMPORTANT: DO NOT REMOVE THIS SCRIPT TAG OR THIS COMMENT! -->

    <!-- IMPORTANT: DO NOT REMOVE THIS SCRIPT TAG OR THIS COMMENT! -->
    <script src="https://cdn.poehali.dev/intertnal/js/pp-min-2.js"></script>
    <script src="https://cdn.poehali.dev/intertnal/js/route-min.js"></script>
    <script src="https://cdn.poehali.dev/intertnal/js/telemetry-min.js"></script>
    <!-- IMPORTANT: DO NOT REMOVE THIS SCRIPT TAG OR THIS COMMENT! -->

    <meta name="pp-name" value="spa-community-portal">
      <script src="https://cdn.poehali.dev/intertnal/js/inspector-min.js"></script>
  </head>

<body>
<div id="root"></div>

<!-- CRITICAL: Clean up old invalid auth tokens BEFORE React loads -->
<script>
(function() {
  try {
    // Version of auth system - increment this to force cleanup on all clients
    var AUTH_SYSTEM_VERSION = '2.1.0';
    var currentVersion = localStorage.getItem('auth_system_version');
    
    // Check both localStorage AND cookies for invalid tokens
    var authTokenLS = localStorage.getItem('auth_token');
    var authTokenCookie = ('; ' + document.cookie).split('; auth_token=').pop().split(';')[0];
    var hasInvalidToken = (authTokenLS && authTokenLS.split('.').length !== 3) || 
                          (authTokenCookie && authTokenCookie.split('.').length !== 3);
    
    var needsCleanup = currentVersion !== AUTH_SYSTEM_VERSION || hasInvalidToken;
    
    if (needsCleanup) {
      console.log('[CLEANUP v2.1] Found invalid token, performing full cleanup');
      console.log('[CLEANUP v2.1] Old token from localStorage:', authTokenLS ? authTokenLS.substring(0, 30) + '...' : 'none');
      console.log('[CLEANUP v2.1] Old token from cookie:', authTokenCookie ? authTokenCookie.substring(0, 30) + '...' : 'none');
      
      // Clear ALL localStorage
      localStorage.clear();
      
      // Set new version
      localStorage.setItem('auth_system_version', AUTH_SYSTEM_VERSION);
      
      // Clear ALL cookies (including auth_token specifically)
      var cookieList = ['auth_token', 'telegram_user', 'yandex_user', 'telegram_auth_refresh_token', 'yandex_auth_refresh_token'];
      for (var i = 0; i < cookieList.length; i++) {
        document.cookie = cookieList[i] + '=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
        document.cookie = cookieList[i] + '=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=' + window.location.hostname + ';';
      }
      
      // Also clear any other cookies
      var cookies = document.cookie.split(';');
      for (var j = 0; j < cookies.length; j++) {
        var cookie = cookies[j];
        var eqPos = cookie.indexOf('=');
        var name = eqPos > -1 ? cookie.substr(0, eqPos).trim() : cookie.trim();
        document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
      }
      
      console.log('[CLEANUP v2.1] Complete! All auth data cleared, version set to ' + AUTH_SYSTEM_VERSION);
      console.log('[CLEANUP v2.1] Page will NOT reload - React will load with clean state');
    } else {
      console.log('[CLEANUP v2.1] Auth system version OK, no cleanup needed');
    }
  } catch (e) {
    console.error('[CLEANUP] Error:', e);
  }
})();
</script>

<script type="module" src="/src/main.tsx"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function (m, e, t, r, i, k, a) {
        m[i] = m[i] || function () {
            (m[i].a = m[i].a || []).push(arguments)
        };
        m[i].l = 1 * new Date();
        for (var j = 0; j < document.scripts.length; j++) {
            if (document.scripts[j].src === r) {
                return;
            }
        }
        k = e.createElement(t), a = e.getElementsByTagName(t)[0], k.async = 1, k.src = r, a.parentNode.insertBefore(k, a)
    })
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(101026698, "init", {
        trustedDomains: ["poehali.dev"],
        clickmap: true,
        trackLinks: true,
        accurateTrackBounce: true,
        webvisor: true,
        trackHash: true
    });
</script>
<noscript>
    <div><img src="https://mc.yandex.ru/watch/101026698" style="position:absolute; left:-9999px;" alt=""/></div>
</noscript>
<!-- /Yandex.Metrika counter -->
</body>
</html>